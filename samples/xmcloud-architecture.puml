@startuml xmcloud

!startsub includes

!define AzurePuml https://raw.githubusercontent.com/plantuml-stdlib/Azure-PlantUML/master/dist
!include AzurePuml/AzureCommon.puml

AzureEntityColoring(CustomEntity)
AzureEntityColoring(SitecoreCloud)
AzureEntityColoring(VercelCloud)
!define CustomEntity(e_alias, e_label, e_techn, e_color, e_sprite, e_stereo) rectangle "==e_label\n<color:e_color>e_sprite</color>\n//<size:TECHN_FONT_SIZE>[e_techn]</size>//" <<e_stereo>> as e_alias
!define CustomEntity(e_alias, e_label, e_techn, e_sprite) CustomEntity(e_alias, e_label, e_techn, AZURE_SYMBOL_COLOR, e_sprite, CustomEntity)

!define SITECOREURL https://raw.githubusercontent.com/jballe/plantuml-sitecore-icons/refs/tags/v2025/sprites
!define SitecoreAiLogo <img:SITECOREURL/ai_64.png>
!define SitecoreLogo <img:SITECOREURL/logo_64.png>
!define SitecoreSearchLogo <img:SITECOREURL/search_64.png>

!define SPRITESURL https://raw.githubusercontent.com/plantuml-stdlib/gilbarbara-plantuml-sprites/v1.1/sprites
!include SPRITESURL/vercel.puml
!include SPRITESURL/graphql.puml
!include SPRITESURL/nextjs.puml
!include SPRITESURL/cloudflare.puml
!include SPRITESURL/github-icon.puml
!include SPRITESURL/graphql.puml


!endsub

!startsub XM_CLOUD

rectangle "<$vercel>" as vercel {
    together {
        CustomEntity(www, "Website", "Vercel Edge", black, "<$cloudflare>", VercelCloud)
        CustomEntity(compute, "Compute\n", "Vercel compute", black, "<$nextjs>", VercelCloud)
    }
    CustomEntity(vercel_build, "Deploy", "Vercel pipeline", black, "<size:60><U+25B2>", VercelCloud)
    rectangle "<$github-icon>\nGitHub app" as vercel_githubapp<<VercelCloud>>

    vercel_githubapp -.up-> vercel_build : trigger
    vercel_build -.up-> www : Static site generation
    vercel_build -.up-> compute : Build and deploy app
    www --> compute

}

CustomEntity(search, "Search", "Sitecore Search", AZURE_SYMBOL_COLOR, SitecoreSearchLogo, SitecoreCloud)
search .-.> www : Crawling website

rectangle "SitecoreAiLogo\nSitecoreAI" as xmcloudlocation {

    CustomEntity(sitecoreportal, "Sitecore Portal", "Sitecore App", AZURE_SYMBOL_COLOR, SitecoreAiLogo, SitecoreCloud)
    CustomEntity(xmcloud_pages, "Pages Builder", "Sitecore App", AZURE_SYMBOL_COLOR, SitecoreAiLogo, SitecoreCloud)
    CustomEntity(xmcloud_editor, "Content Editor", "Sitecore App", AZURE_SYMBOL_COLOR, SitecoreAiLogo, SitecoreCloud)
    CustomEntity(xmcloud_forms, "Forms", "Sitecore App", AZURE_SYMBOL_COLOR, SitecoreAiLogo, SitecoreCloud)
    CustomEntity(xmcloud, "Experience Edge", "GraphQL/Layout service", AZURE_SYMBOL_COLOR, <$graphql>, SitecoreCloud)
    CustomEntity(xmcloud_storage, "CM", "Sitecore Data Storage", AZURE_SYMBOL_COLOR, SitecoreAiLogo, SitecoreCloud)
    CustomEntity(xmcloud_pipeline, "SitecoreAI Deploy", "Sitecore Pipeline", AZURE_SYMBOL_COLOR, SitecoreAiLogo, SitecoreCloud)
    CustomEntity(xmcloud_editinghost, "Editing Host\n", "Custom website", "black", "<$nextjs>", SitecoreCloud)
    rectangle "<$github-icon>\nGitHub app" as xmcloud_githubapp<<SitecoreCloud>>

    sitecoreportal -.-> xmcloud_pages
    sitecoreportal -.-> xmcloud_editor
    sitecoreportal -.-> xmcloud_forms

    xmcloud_pages -.-.-> xmcloud_editinghost
    xmcloud_pages --> xmcloud_storage
    xmcloud_editor --> xmcloud_storage
    xmcloud_forms --> xmcloud_storage
    xmcloud_editinghost -up-> xmcloud

    xmcloud_storage -up.-> xmcloud : publish content
    compute ---> xmcloud : api

    xmcloud_pipeline -up.-> xmcloud_editor : deploy
    xmcloud_pipeline -up.-> xmcloud_editinghost : deploy

    xmcloud_githubapp -up.-> xmcloud_pipeline : trigger

}

!endsub

CustomEntity(app, "App", "Sitecore Marketplace", AZURE_SYMBOL_COLOR, SitecoreLogo, VercelCloud)
xmcloud_pages -.up-> app
sitecoreportal -.up-> app
app ---> xmcloud_editinghost
app --> xmcloud

sitecoreportal -[hidden]right-> vercel


@enduml