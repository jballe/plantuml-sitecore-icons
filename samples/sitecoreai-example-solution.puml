@startuml c2-containers
title C2: Containers for sample solution
hide stereotype

!define SITECOREAI_DETAILS 1
!includesub xmcloud-architecture.puml!includes

!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml
SHOW_PERSON_PORTRAIT()

!define TUPADR https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/refs/tags/v3.0.0/icons
!define FONTAWESOME TUPADR/font-awesome-5
!include FONTAWESOME/users.puml

!include <azure/AzureCommon>
'!includeurl AzurePuml/AzureC4Integration.puml
!include <azure/General/Azure>
!include <azure/Identity/AzureActiveDirectory>
!include <azure/Identity/AzureActiveDirectoryB2C>
!include <azure/Web/AzureAPIManagement>
!include <azure/Containers/AzureContainerInstance>
!include <azure/Compute/AzureAppService>

!include TUPADR/font-awesome/database.puml

!define SPRITESURL https://raw.githubusercontent.com/plantuml-stdlib/gilbarbara-plantuml-sprites/v1.1/sprites
!include SPRITESURL/github.puml
!include SPRITESURL/github-icon.puml
!include SPRITESURL/git.puml
!include SPRITESURL/git-icon.puml
!include <office/Servers/web_server>

AzureEntityColoring(SaasService)
!define SaasService(e_alias, e_label, e_techn) AzureEntity(e_alias, e_label, e_techn, AZURE_SYMBOL_COLOR, AzureAppService, SaasService)

skinparam rectangle<<location>> {
    StereotypeFontSize 0
    BorderStyle dashed
    Shadowing false
}
skinparam actor {
    BorderColor black
    BackgroundColor white
    Shadowing false
}

Person(visitor, "Visitor")

cloud "Microsoft Azure, Subscription 1" as microsoft <<location>> {
    AzureActiveDirectory(ad, "Internal Users", "Azure Active Directory")
    AzureActiveDirectoryB2C(b2c, "External Users", "Azure Active Directory B2C")

    AzureAPIManagement(apimgm, "API Gateway", "Azure API Management")
    CustomEntity(pim, "PIM", "PIM", <$database>)
    apimgm --> pim
}

cloud "SitecoreLogo\nSitecore SaaS Solutions" as sitecore <<location>> {
    CustomEntity(search, "Search", "Sitecore Search", AZURE_SYMBOL_COLOR, SitecoreSearchLogo, SitecoreCloud)

    !if SITECOREAI_DETAILS == "1"
    !includesub xmcloud-architecture.puml!XM_CLOUD
    !else
    CustomEntity(sitecoreai, "SitecoreAI", "SitecoreAI Cloud", AZURE_SYMBOL_COLOR, SitecoreAiLogo, SitecoreCloud)
    CustomEntity(www, "my-website.com", "Vercel website", black, "<size:60><U+25B2>", VercelCloud)
    !endif
}

Rel_D(search, www, "Crawl content")
Rel(www, sitecoreai, "Fetch content")
Rel(www, apimgm, "Fetch product data")
Rel(www, b2c, "User Authentication")

visitor -Down.-> www
visitor -Down.-.-> b2c: Single-Sign-On

Person(editor, "Content Editor")
Rel_D(editor, ad, "SSO", "https")
!if SITECOREAI_DETAILS == "1"
Rel_D(editor, sitecoreportal, "sitecorecloud.io", "https")
Rel_D(editor, sitecoreai_pages, "sitecorecloud.io", "https")
!else
Rel_U(editor, sitecoreai, "sitecorecloud.io", "https")
!endif


!if SITECOREAI_DETAILS == "1"

rectangle "<$github>" as GitHubCloud<<location>> {
    database "<$git>" as repo<<CustomEntity>>
}

Person(developer, "Developer")
Rel_U(developer, repo, "Push code")
Rel_U(repo, vercel_githubapp, "Commit Webhook")
Rel_U(repo, sitecoreai_githubapp, "Commit Webhook")

www -[hidden]- sitecoreportal
!endif



@enduml