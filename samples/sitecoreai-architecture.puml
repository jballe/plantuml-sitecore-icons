@startuml xmcloud

!startsub includes

!define AzurePuml https://raw.githubusercontent.com/plantuml-stdlib/Azure-PlantUML/master/dist
!include AzurePuml/AzureCommon.puml
AzureEntityColoring(CustomEntity)
AzureEntityColoring(Sitecore)
AzureEntityColoring(VercelCloud)
!define CustomEntity(e_alias, e_label, e_techn, e_color, e_sprite, e_stereo) rectangle "==e_label\n<color:e_color>e_sprite</color>\n//<size:TECHN_FONT_SIZE>[e_techn]</size>//" <<e_stereo>> as e_alias
!define CustomEntity(e_alias, e_label, e_techn, e_sprite) CustomEntity(e_alias, e_label, e_techn, AZURE_SYMBOL_COLOR, e_sprite, CustomEntity)

!define SITECOREURL https://raw.githubusercontent.com/jballe/plantuml-sitecore-icons/refs/tags/v2025.1/sprites
!includeurl SITECOREURL/all.puml

!define SPRITESURL https://raw.githubusercontent.com/plantuml-stdlib/gilbarbara-plantuml-sprites/v1.1/sprites
!include SPRITESURL/vercel.puml
!include SPRITESURL/graphql.puml
!include SPRITESURL/nextjs.puml
!include SPRITESURL/cloudflare.puml
!include SPRITESURL/github-icon.puml
!include SPRITESURL/graphql.puml


!endsub

!startsub XM_CLOUD

rectangle "<$vercel>" as vercel {
    together {
        CustomEntity(www, "Website", "Vercel Edge", black, "<$cloudflare>", VercelCloud)
        CustomEntity(compute, "Compute\n", "Vercel compute", black, "<$nextjs>", VercelCloud)
    }
    CustomEntity(vercel_build, "Deploy", "Vercel pipeline", black, "<size:60><U+25B2>", VercelCloud)
    CustomEntity(vercel_githubapp, "GitHub app", "SaaS", black, "<$github-icon>", VercelCloud)

    vercel_githubapp -.up-> vercel_build : trigger
    vercel_build -.up-> www : Static site generation
    vercel_build -.up-> compute : Build and deploy app
    www --> compute

}

SITECORE_SEARCH(search, "Search", "Sitecore Search")
search .-.> www : Crawling website

rectangle "SitecoreAiLogo\nSitecoreAI" as sitecoreailocation {

    SITECORE_AI_LOGO(sitecoreportal, "Sitecore Portal", "Sitecore App", "Starting point for all editors")
    SITECORE_AI_LOGO(sitecoreai_pages, "Pages Builder", "Sitecore App", "Edit pages and content")
    SITECORE_AI_LOGO(sitecoreai_editor, "Content Editor", "Sitecore App", "Old editor for all content")
    SITECORE_AI_LOGO(sitecoreai_forms, "Forms", "Sitecore App", "Edit and publish forms")
    SITECORE_AI_LOGO(sitecoreai, "Experience Edge", "GraphQL/Layout service", "Content ready at edge")
    SITECORE_AI_LOGO(sitecoreai_storage, "CM", "Sitecore Data Storage", "Sitecore managed CM instance with database etc.")
    SITECORE_AI_LOGO(sitecoreai_pipeline, "SitecoreAI Deploy", "Sitecore Pipeline", "Manages deploy of editing host and CM, and automatic upgrades")
    CustomEntity(sitecoreai_editinghost, "Editing Host\n", "Custom website", "black", "<$nextjs>", Sitecore)
    CustomEntity(sitecoreai_githubapp, "GitHub app", "SaaS", "black", "<$github-icon>", Sitecore)

    sitecoreportal -.-> sitecoreai_pages
    sitecoreportal -.-> sitecoreai_editor
    sitecoreportal -.-> sitecoreai_forms

    sitecoreai_pages -.-.->      sitecoreai_editinghost
    sitecoreai_pages -->         sitecoreai_storage
    sitecoreai_editor -->        sitecoreai_storage
    sitecoreai_forms -->         sitecoreai_storage
    sitecoreai_editinghost -up-> sitecoreai

    sitecoreai_storage -up.-> sitecoreai : publish content
    compute ---> sitecoreai : api

    sitecoreai_pipeline -up.-> sitecoreai_editor : deploy
    sitecoreai_pipeline -up.-> sitecoreai_editinghost : deploy

    sitecoreai_githubapp -up.-> sitecoreai_pipeline : trigger

}

!endsub

SITECORE_LOGO(app, "App", "Sitecore Marketplace", "Custom app with specific functionality")
sitecoreai_pages -.up-> app
sitecoreportal -.up-> app
app ---> sitecoreai_editinghost
app --> sitecoreai

sitecoreportal -[hidden]right-> vercel


@enduml